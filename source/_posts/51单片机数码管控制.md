---
title: 51单片机数码管显示
date: 2019-11-23 14:30:30
tags: 
	- 单片机
	- C语言
	- 数码管
autor: hehung
categories: 51单片机
img: https://cdn.jsdelivr.net/gh/hehung/cdn-jsDelivr-hehung-blog-sources/51-Digital_tube/1.jpg
cover: false
coverImg: https://cdn.jsdelivr.net/gh/hehung/cdn-jsDelivr-hehung-blog-sources/51-Digital_tube/1.jpg
top: false
summary: 使用51单片机完成的一个控制数码管显示的程序，数码管会从右向左滚动显示1-F这些数字和字母。
---

>上一次做了一个流水灯，现在还是从基础做起，做一个可以滚动显示的数码管。废话不多说，首先展示一下滚动显示的效果，原帖子链接：[点我跳转](https://bbs.icxbk.com/thread-100110-1-1.html)

# 效果展示

&emsp;&emsp;程序实现了动态数码管的显示，滚动显示1-F，如下图所示，
&emsp;&emsp;由于使用手机自带的gif拍摄的图片，只能拍摄很短的gif图片，所以就多放了几张。
&emsp;&emsp;我是向左滚动的滚动的时间大约500ms左右，随便写的，并不准确，会循环连续的滚动，图中不太容易看出效果。

![运行效果](https://cdn.jsdelivr.net/gh/hehung/cdn-jsDelivr-hehung-blog-sources/51-Digital_tube/2.gif "运行效果")

![运行效果](https://cdn.jsdelivr.net/gh/hehung/cdn-jsDelivr-hehung-blog-sources/51-Digital_tube/3.gif "运行效果")


# 原理图

&emsp;&emsp;在单片机开发中，能看懂原理图是非常重要的，因为单片机的开发一般都是对外设的驱动，知道电路如何连接，才能很好的控制。

&emsp;&emsp;首先打开原理图，可以看到原理图中所有的数码管都是接在J16上的，而J16又是通过译码器连接到J6，单片机上的A,B,C引脚。所以通过A,B,C可以控制数码管得位选。

![原理图](https://cdn.jsdelivr.net/gh/hehung/cdn-jsDelivr-hehung-blog-sources/51-Digital_tube/4.png "原理图")

&emsp;&emsp;同时，原理图还说明了数码管是共阴的，也就是阴极都是连在一起的，如果要控制数码管亮的话，就需要在阳极给高电位，也就是给1。

&emsp;&emsp;这里说一下我的数码管的链接引脚：
A ===  P1.0
B ===  P1.1
C ===  P1.2
然后就是J12口是控制段选的，J12通过P0口控制。


# 数码管控制原理

## 位选和段选

&emsp;&emsp;因为单片机的控制引脚有限，一个数码管在操作的时候会使用8个IO口进行控制，为了减少IO口的开销，在电路设计上就是用了段选和位选来用相同的IO口数对多个数码管进行操作。

&emsp;&emsp;对多个数码管操作的时候有段选和位选：位选就是选择某一个数码管，对其进行操作；段选就是选择数码管的某一段操作，一般数码管有7段，如果数码管有小数点的话就会有8段，就可以通过8个IO口对数码管的每一段的亮灭进行控制。

## 位选控制

&emsp;&emsp;位选是如何工作的呢？这里有8个数码管，但是只有三个控制引脚，因为有译码器，所以给这三个引脚不同的值就会控制打开不同的数码管，比如：
+ A=0，B=0，C=0就是控制第1个数码管
+ A=0，B=0，C=1就是控制第2个数码管
+ ...

## 段选控制

&emsp;&emsp;段选使用8个IO口进行控制。如原理图中所示的J12，因为数码管是共阴的，所以控制IO输出为1就会使相应的一段变亮。

&emsp;&emsp;原理图中对数码管的的每一段都有标注a,b,c,d,e,f,g,dp。如果将J12连接到P0，也就是P0.7控制a，P0.6控制b ... P0.0控制dp。

&emsp;&emsp;所以，如果要控制数码管显示数字，应该给IO口P0赋值下列数字：
+ 0 -- 0x3f 
+ 1 -- 0x06 
+ 2 -- 0x5b
+ 3 -- 0x4f
+ 4 -- 0x66
+ 5 -- 0x6d
+ 6 -- 0x7d
+ 7 -- 0x07
+ 8 -- 0x7f
+ 9 -- 0x6f
+ A -- 0x77
+ B -- 0x7c
+ C -- 0x39
+ D -- 0x5e
+ E -- 0x79
+ F -- 0x71 

# 程序编辑

&emsp;&emsp;知道了原理图的连接和控制原理，现在就可以对数码管的显示进行程序程序的编写了。

``` C
#include<reg52.h>

#define uchar unsigned char
#define uint unsigned int
#define SMG P0                //定义数码管的段选端口

//下述的A,B,C的信号进过译码器解码后可以控制8个数码管的显示
sbit LA=P1^0;                
sbit LB=P1^1;
sbit LC=P1^2;

//下面的数组可以显示0-F
uchar code number[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,
                                        0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};

//函数声明
void delay(int ms);
void change(int what);

//延时函数(短延时)
void delay(int ms)
{
        for(;ms>0;ms--);
}

//该函数可以选择某一个数码管显示
void change(int what)
{
        switch(what)
        {
                case 1:LC=0;LB=0;LA=0;break;
                case 2:LC=0;LB=0;LA=1;break;
                case 3:LC=0;LB=1;LA=0;break;
                case 4:LC=0;LB=1;LA=1;break;
                case 5:LC=1;LB=0;LA=0;break;
                case 6:LC=1;LB=0;LA=1;break;
                case 7:LC=1;LB=1;LA=0;break;
                case 8:LC=1;LB=1;LA=1;break;                
        }
}
                                        
int main()
{
        uchar i;
        uchar j=0;
        uint time=50;
        
        while(1)
        {
                for(;time>0;time--)
                {
                        for(i=1;i<=8;i++)
                        {
                                change(i);
                                SMG = number[(j+i)%16];                //使之可以滚动显示的处理        
                                delay(100);
                                SMG = 0;
                                delay(50);         //消除暗影
                        }                
                }
                time = 50;
                j++;
                if(j>17)
                        j = 0;
        }

}
```

上述程序就是实现了对8个数码管显示0-F的滚动显示程序。








